let quizQuestions=[],currentQuestion=0,quizScore=0,answered=!1,quizStartHearts=0;async function startQuiz(){try{const e=await fetch("/api/quiz-questions");quizQuestions=await e.json()}catch(e){return void showNotification("Failed to load questions. Try again!")}currentQuestion=0,quizScore=0,answered=!1,quizStartHearts=getHearts().current,document.getElementById("quizStart").style.display="none",document.getElementById("quizArea").style.display="block",updateStreak(),displayQuestion()}function displayQuestion(){if(currentQuestion>=quizQuestions.length)return void showQuizResults();answered=!1;const e=quizQuestions[currentQuestion],t=quizQuestions.length,n=currentQuestion/t*100;document.getElementById("quizProgressFill").style.width=n+"%",document.getElementById("quizProgressText").textContent=`${currentQuestion+1}/${t}`,document.getElementById("quizScore").textContent=`Score: ${quizScore}`,document.getElementById("quizQuestion").textContent=e.question;const o=document.getElementById("quizOptions");o.innerHTML="",e.options.forEach((e,t)=>{const n=document.createElement("button");n.className="quiz-option",n.textContent=e,n.onclick=()=>selectAnswer(t),o.appendChild(n)}),document.getElementById("quizFact").style.display="none",document.getElementById("quizNextBtn").style.display="none","undefined"!=typeof Mascot&&Mascot.onThink();const s=document.getElementById("quizCard");s.style.animation="none",s.offsetHeight,s.style.animation="slideUp 0.4s ease-out"}function selectAnswer(e){if(answered)return;answered=!0;const t=quizQuestions[currentQuestion],n=document.querySelectorAll(".quiz-option");n.forEach(e=>e.classList.add("disabled")),e===t.correct?(n[e].classList.add("correct"),quizScore++,playSound("correct"),addXP(10),document.getElementById("quizScore").textContent=`Score: ${quizScore}`,"undefined"!=typeof Mascot&&Mascot.onCorrect()):(n[e].classList.add("wrong"),n[t.correct].classList.add("correct"),playSound("wrong"),loseHeart(),"undefined"!=typeof Mascot&&Mascot.onWrong());const o=document.getElementById("quizFact");o.textContent="ðŸ’¡ "+t.fact,o.style.display="block";const s=document.getElementById("quizNextBtn");currentQuestion<quizQuestions.length-1?s.textContent="Next Question â†’":s.textContent="See Results! ðŸ†",s.style.display="inline-flex"}function nextQuestion(){hasHearts()&&(currentQuestion++,displayQuestion())}function showQuizResults(){const e=quizQuestions.length;document.getElementById("quizProgressFill").style.width="100%",document.getElementById("quizProgressText").textContent="Done!",addXP(50),quizScore===e&&addXP(25),markNodeComplete("quiz"),getHearts().current===quizStartHearts&&awardAchievement("no_hearts_lost"),quizScore===e&&awardAchievement("perfect_score"),showResults("Quiz Complete!",quizScore,e,"quiz")}