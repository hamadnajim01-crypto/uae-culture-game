const LANG_MAP={ar:{name:"Arabic",flag:"üá¶üá™"},en:{name:"English",flag:"üá¨üáß"},fr:{name:"French",flag:"üá´üá∑"},es:{name:"Spanish",flag:"üá™üá∏"},de:{name:"German",flag:"üá©üá™"},it:{name:"Italian",flag:"üáÆüáπ"},pt:{name:"Portuguese",flag:"üáµüáπ"},ru:{name:"Russian",flag:"üá∑üá∫"},zh:{name:"Chinese",flag:"üá®üá≥"},ja:{name:"Japanese",flag:"üáØüáµ"},ko:{name:"Korean",flag:"üá∞üá∑"},hi:{name:"Hindi",flag:"üáÆüá≥"},tr:{name:"Turkish",flag:"üáπüá∑"},nl:{name:"Dutch",flag:"üá≥üá±"},pl:{name:"Polish",flag:"üáµüá±"},sv:{name:"Swedish",flag:"üá∏üá™"},da:{name:"Danish",flag:"üá©üá∞"},fi:{name:"Finnish",flag:"üá´üáÆ"},nb:{name:"Norwegian",flag:"üá≥üá¥"},no:{name:"Norwegian",flag:"üá≥üá¥"},he:{name:"Hebrew",flag:"üáÆüá±"},th:{name:"Thai",flag:"üáπüá≠"},id:{name:"Indonesian",flag:"üáÆüá©"},vi:{name:"Vietnamese",flag:"üáªüá≥"},uk:{name:"Ukrainian",flag:"üá∫üá¶"},cs:{name:"Czech",flag:"üá®üáø"},el:{name:"Greek",flag:"üá¨üá∑"},ro:{name:"Romanian",flag:"üá∑üá¥"},hu:{name:"Hungarian",flag:"üá≠üá∫"},sk:{name:"Slovak",flag:"üá∏üá∞"},bg:{name:"Bulgarian",flag:"üáßüá¨"},hr:{name:"Croatian",flag:"üá≠üá∑"},ur:{name:"Urdu",flag:"üáµüá∞"},bn:{name:"Bengali",flag:"üáßüá©"},ta:{name:"Tamil",flag:"üáÆüá≥"},fil:{name:"Filipino",flag:"üáµüá≠"},ms:{name:"Malay",flag:"üá≤üáæ"}},PREVIEW_PHRASES={ar:"ŸÖÿ±ÿ≠ÿ®ÿß! ÿ£ŸáŸÑÿß Ÿàÿ≥ŸáŸÑÿß ÿ®ŸÉŸÖ",en:"Welcome to UAE Culture Learning Kids!",fr:"Bienvenue! Explorons la culture des √âmirats!",es:"¬°Bienvenidos! Exploremos la cultura de los Emiratos!",de:"Willkommen! Lasst uns die Kultur der Emirate erkunden!",it:"Benvenuti! Esploriamo la cultura degli Emirati!",pt:"Bem-vindos! Vamos explorar a cultura dos Emirados!",ru:"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –î–∞–≤–∞–π—Ç–µ –∏–∑—É—á–∏–º –∫—É–ª—å—Ç—É—Ä—É –û–ê–≠!",zh:"Ê¨¢ËøéÊù•Âà∞ÈòøËÅîÈÖãÊñáÂåñÂ≠¶‰π†ÔºÅ",ja:"UAE„ÅÆÊñáÂåñ„ÇíÂ≠¶„Å≥„Åæ„Åó„Çá„ÅÜÔºÅ„Çà„ÅÜ„Åì„ÅùÔºÅ",ko:"UAE Î¨∏ÌôîÎ•º Î∞∞ÏõåÎ¥ÖÏãúÎã§! ÌôòÏòÅÌï©ÎãàÎã§!",hi:"UAE ‡§ï‡•Ä ‡§∏‡§Ç‡§∏‡•ç‡§ï‡•É‡§§‡§ø ‡§∏‡•Ä‡§ñ‡•á‡§Ç! ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à!",tr:"BAE k√ºlt√ºr√ºn√º ke≈üfedelim! Ho≈ü geldiniz!",ur:"!UAE ÿ´ŸÇÿßŸÅÿ™ ÿ≥€å⁄©⁄æ€å⁄∫€î ÿÆŸàÿ¥ ÿ¢ŸÖÿØ€åÿØ",nl:"Welkom! Laten we de cultuur van de Emiraten verkennen!"};let currentFilter="all";function getSavedVoiceName(){return localStorage.getItem("uaequest_voice")||null}function getSavedSpeed(){return parseFloat(localStorage.getItem("uaequest_voice_speed")||"0.9")}function getSavedPitch(){return parseFloat(localStorage.getItem("uaequest_voice_pitch")||"1.05")}function getAllVoices(){return"speechSynthesis"in window?speechSynthesis.getVoices():[]}function getLangCode(e){return e.split("-")[0].toLowerCase()}function getLangInfo(e){const n=getLangCode(e);return LANG_MAP[n]||{name:e,flag:"üåê"}}function getGroupedVoices(){const e=getAllVoices(),n={};return e.forEach(e=>{const a=getLangCode(e.lang);if(!n[a]){const t=getLangInfo(e.lang);n[a]={code:a,name:t.name,flag:t.flag,voices:[]}}n[a].voices.push(e)}),Object.values(n).sort((e,n)=>"ar"===e.code?-1:"ar"===n.code?1:"en"===e.code?-1:"en"===n.code?1:e.name.localeCompare(n.name))}function selectVoice(e){localStorage.setItem("uaequest_voice",e),document.querySelectorAll(".voice-item").forEach(n=>{n.classList.toggle("selected",n.dataset.voice===e)});const n=document.getElementById("voiceCurrentInfo");n&&(n.innerHTML=`<span class="voice-current-label">Selected:</span> <strong>${e}</strong>`)}function previewVoice(e,n){if(!("speechSynthesis"in window))return;speechSynthesis.cancel();const a=new SpeechSynthesisUtterance(PREVIEW_PHRASES[n]||PREVIEW_PHRASES.en);a.rate=getSavedSpeed(),a.pitch=getSavedPitch();const t=getAllVoices().find(n=>n.name===e);t&&(a.voice=t),speechSynthesis.speak(a)}function filterVoices(e){currentFilter=e;const n=document.getElementById("voicePanel");n&&(n.querySelectorAll(".voice-filter-btn").forEach(n=>{n.classList.toggle("active",n.dataset.lang===e)}),n.querySelectorAll(".voice-group").forEach(n=>{n.style.display="all"===e||n.dataset.lang===e?"block":"none"}))}function updateSpeedDisplay(e){localStorage.setItem("uaequest_voice_speed",e);const n=document.getElementById("speedValue");n&&(n.textContent=e+"x")}function updatePitchDisplay(e){localStorage.setItem("uaequest_voice_pitch",e);const n=document.getElementById("pitchValue");n&&(n.textContent=parseFloat(e).toFixed(2))}function buildVoicePanel(){const e=getGroupedVoices(),n=getSavedVoiceName(),a=getSavedSpeed(),t=getSavedPitch();let i=`<button class="voice-filter-btn active" data-lang="all" onclick="filterVoices('all')">üåç All (${e.reduce((e,n)=>e+n.voices.length,0)})</button>`;e.forEach(e=>{i+=`<button class="voice-filter-btn" data-lang="${e.code}" onclick="filterVoices('${e.code}')">${e.flag} ${e.name} (${e.voices.length})</button>`});let o="";return 0===e.length?o='<p class="voice-empty">No voices found. Try reopening this panel in a moment.</p>':e.forEach(e=>{let a="";e.voices.forEach(t=>{const i=t.name.replace("Microsoft ","").replace("Google ","").replace(" Online (Natural)","").replace(" Desktop",""),o=t.name===n,l=t.name.replace(/'/g,"\\'");a+=`\n          <div class="voice-item ${o?"selected":""}" data-voice="${t.name}" onclick="selectVoice('${l}')">\n            <div class="voice-item-info">\n              <div class="voice-item-name">${i}</div>\n              <div class="voice-item-lang">${t.lang}${t.localService?"":" ¬∑ Cloud"}</div>\n            </div>\n            <button class="voice-item-preview" onclick="event.stopPropagation(); previewVoice('${l}', '${e.code}')">‚ñ∂ Test</button>\n          </div>\n        `}),o+=`\n        <div class="voice-group" data-lang="${e.code}">\n          <div class="voice-group-label">${e.flag} ${e.name} <span class="voice-group-count">(${e.voices.length})</span></div>\n          <div class="voice-list">${a}</div>\n        </div>\n      `}),`\n    <button class="voice-panel-close" onclick="toggleVoicePanel()">‚úï</button>\n    <h3>‚öôÔ∏è Voice Settings</h3>\n    <p class="voice-panel-desc">Pick a voice and language for narration</p>\n\n    <div class="voice-speed-control">\n      <label>Speed</label>\n      <input type="range" min="0.5" max="1.5" step="0.1" value="${a}"\n             oninput="updateSpeedDisplay(this.value)">\n      <div class="voice-speed-value" id="speedValue">${a}x</div>\n    </div>\n\n    <div class="voice-speed-control">\n      <label>Pitch</label>\n      <input type="range" min="0.5" max="1.5" step="0.05" value="${t}"\n             oninput="updatePitchDisplay(this.value)">\n      <div class="voice-speed-value" id="pitchValue">${t.toFixed(2)}</div>\n    </div>\n\n    <div class="voice-current-info" id="voiceCurrentInfo">\n      ${n?`<span class="voice-current-label">Selected:</span> <strong>${n}</strong>`:'<span class="voice-current-label">Using default voice</span>'}\n    </div>\n\n    <div class="voice-filters" id="voiceFilters">${i}</div>\n\n    <div class="voice-groups">${o}</div>\n  `}function toggleVoicePanel(){let e=document.getElementById("voicePanel");if(e)return e.classList.remove("open"),void setTimeout(()=>{e.parentNode&&e.remove()},350);e=document.createElement("div"),e.id="voicePanel",e.className="voice-panel",e.innerHTML=buildVoicePanel(),document.body.appendChild(e),requestAnimationFrame(()=>{requestAnimationFrame(()=>e.classList.add("open"))}),setTimeout(()=>{document.addEventListener("click",function e(n){const a=document.getElementById("voicePanel"),t=document.getElementById("voiceSettingsBtn");!a||a.contains(n.target)||n.target===t||t.contains(n.target)||(a.classList.remove("open"),setTimeout(()=>{a.parentNode&&a.remove()},350),document.removeEventListener("click",e))})},200)}"speechSynthesis"in window&&(speechSynthesis.onvoiceschanged=()=>speechSynthesis.getVoices(),speechSynthesis.getVoices());