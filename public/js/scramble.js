let scrambleData=[],scrambleCurrent=0,scrambleScore=0,scrambleAnswered=!1,scrambleSelected=[],scrambleStartHearts=0;async function startScramble(){try{const e=await fetch("/api/scramble");scrambleData=await e.json()}catch(e){return void showNotification("Failed to load words!")}scrambleCurrent=0,scrambleScore=0,scrambleAnswered=!1,scrambleSelected=[],scrambleStartHearts=getHearts().current,document.getElementById("scrambleStart").style.display="none",document.getElementById("scrambleArea").style.display="block",updateStreak(),showScrambleWord()}function showScrambleWord(){if(scrambleCurrent>=scrambleData.length)return void finishScramble();scrambleAnswered=!1,scrambleSelected=[];const e=scrambleData[scrambleCurrent],t=scrambleData.length;document.getElementById("scrambleProgressFill").style.width=scrambleCurrent/t*100+"%",document.getElementById("scrambleProgressText").textContent=`${scrambleCurrent+1}/${t}`,document.getElementById("scrambleScore").textContent=`SCORE: ${scrambleScore}`;const r=document.getElementById("scrambleHearts");if(r){const e=getHearts();r.textContent="â¤ï¸".repeat(e.current)+"ðŸ–¤".repeat(5-e.current)}document.getElementById("scrambleHint").textContent="ðŸ’¡ "+e.hint,updateScrambleAnswer(e.word.length);const a=document.getElementById("scrambleLetters");a.innerHTML="";const s=e.word.toUpperCase().split(""),c=[...s].sort(()=>Math.random()-.5);if(c.join("")===s.join("")){const e=c[0];c[0]=c[c.length-1],c[c.length-1]=e}c.forEach((e,t)=>{const r=document.createElement("button");r.className="scramble-tile",r.textContent=e,r.dataset.index=t,r.onclick=()=>tapScrambleLetter(r,e),a.appendChild(r)}),document.getElementById("scrambleFact").style.display="none",document.getElementById("scrambleNextBtn").style.display="none","undefined"!=typeof Mascot&&Mascot.onThink();const n=document.getElementById("scrambleCard");n.style.animation="none",n.offsetHeight,n.style.animation="fadeUp 0.4s ease"}function tapScrambleLetter(e,t){if(scrambleAnswered||e.classList.contains("used"))return;const r=scrambleData[scrambleCurrent];e.classList.add("used"),scrambleSelected.push({tile:e,letter:t}),playSound("flip"),updateScrambleAnswer(r.word.length)}function updateScrambleAnswer(e){const t=document.getElementById("scrambleAnswer");t.innerHTML="";for(let r=0;r<e;r++){const e=document.createElement("span");e.className="scramble-slot",scrambleSelected[r]?(e.textContent=scrambleSelected[r].letter,e.classList.add("filled")):e.textContent="_",t.appendChild(e)}}function clearScramble(){if(scrambleAnswered)return;scrambleSelected.forEach(e=>{e.tile.classList.remove("used")}),scrambleSelected=[];updateScrambleAnswer(scrambleData[scrambleCurrent].word.length)}function checkScramble(){if(scrambleAnswered)return;const e=scrambleData[scrambleCurrent],t=scrambleSelected.map(e=>e.letter).join("");if(t.length<e.word.length){const e=document.getElementById("scrambleAnswer");return e.classList.add("shake"),void setTimeout(()=>e.classList.remove("shake"),500)}scrambleAnswered=!0;const r=t.toUpperCase()===e.word.toUpperCase(),a=document.getElementById("scrambleAnswer");if(r?(a.classList.add("scramble-correct"),scrambleScore++,playSound("correct"),addXP(10),"undefined"!=typeof Mascot&&Mascot.onCorrect()):(a.classList.add("scramble-wrong"),playSound("wrong"),loseHeart(),"undefined"!=typeof Mascot&&Mascot.onWrong(),setTimeout(()=>{a.innerHTML="",e.word.toUpperCase().split("").forEach(e=>{const t=document.createElement("span");t.className="scramble-slot filled correct-letter",t.textContent=e,a.appendChild(t)})},800)),document.getElementById("scrambleScore").textContent=`SCORE: ${scrambleScore}`,e.fact){const t=document.getElementById("scrambleFact");t.textContent="ðŸ’¡ "+e.fact,t.style.display="block"}const s=document.getElementById("scrambleNextBtn");s.textContent=scrambleCurrent<scrambleData.length-1?"NEXT â†’":"SEE RESULTS ðŸ†",s.style.display="inline-flex";const c=document.getElementById("scrambleHearts");if(c){const e=getHearts();c.textContent="â¤ï¸".repeat(e.current)+"ðŸ–¤".repeat(5-e.current)}}function nextScrambleWord(){hasHearts()&&(scrambleCurrent++,showScrambleWord())}function finishScramble(){const e=scrambleData.length;addXP(50),scrambleScore===e&&addXP(25),markNodeComplete("scramble"),getHearts().current===scrambleStartHearts&&awardAchievement("no_hearts_lost"),scrambleScore===e&&awardAchievement("perfect_score"),showResults("Word Scramble Complete!",scrambleScore,e,"scramble")}