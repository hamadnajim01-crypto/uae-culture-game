function getPlayerName(){return localStorage.getItem("uaequest_player")||"Explorer"}function setPlayerName(e){localStorage.setItem("uaequest_player",e)}function startExploring(){const e=document.getElementById("playerName");if(!e)return;const t=e.value.trim()||"Explorer";setPlayerName(t);const n=document.getElementById("gamesSection");n&&n.scrollIntoView({behavior:"smooth"}),showNotification(`Welcome, ${t}! Let's explore UAE culture! üá¶üá™`)}function getStars(){const e=JSON.parse(localStorage.getItem("uaequest_scores")||"{}");let t=0;for(const n of Object.values(e))t+=n.stars||0;return t}function saveGameScore(e,t,n){const a=JSON.parse(localStorage.getItem("uaequest_scores")||"{}"),s=n>0?Math.ceil(t/n*3):0;return a[e]={score:t,total:n,stars:s},localStorage.setItem("uaequest_scores",JSON.stringify(a)),updateStarsDisplay(),s}function getXPBreakdown(e,t){const n=10*e,a=e===t?25:0;return{perQuestion:n,completionBonus:50,perfectBonus:a,total:n+50+a}}function updateStarsDisplay(){const e=document.getElementById("navStars");e&&(e.textContent=`‚≠ê ${getStars()} Stars`)}function updateCardStars(){const e=JSON.parse(localStorage.getItem("uaequest_scores")||"{}");document.querySelectorAll(".card-stars").forEach(t=>{const n=t.dataset.game;if(e[n]){const a=e[n].stars||0;t.textContent="‚òÖ".repeat(a)+"‚òÜ".repeat(3-a),t.style.color="#D4A24E"}})}function toggleNav(){document.querySelector(".nav-links").classList.toggle("open")}function initFactsCarousel(){const e=document.getElementById("factsCarousel"),t=document.getElementById("factsDots");if(!e||!t)return;const n=e.querySelectorAll(".fact-card");let a=0;function s(e){n[a].classList.remove("active"),t.children[a].classList.remove("active"),a=e,n[a].classList.add("active"),t.children[a].classList.add("active")}n.forEach((e,n)=>{const a=document.createElement("div");a.className="fact-dot"+(0===n?" active":""),a.onclick=()=>s(n),t.appendChild(a)});let o=0;e.addEventListener("touchstart",e=>{o=e.changedTouches[0].screenX},{passive:!0}),e.addEventListener("touchend",e=>{const t=o-e.changedTouches[0].screenX;Math.abs(t)>50&&s(t>0?(a+1)%n.length:(a-1+n.length)%n.length)}),setInterval(()=>{s((a+1)%n.length)},5e3)}function showNotification(e,t=3e3){const n=document.createElement("div");n.style.cssText="\n    position: fixed;\n    top: 80px;\n    left: 50%;\n    transform: translateX(-50%) translateY(-20px);\n    background: linear-gradient(135deg, #D4A24E, #B8872F);\n    color: #1A1A2E;\n    padding: 14px 28px;\n    border-radius: 24px;\n    font-family: 'Fredoka', sans-serif;\n    font-weight: 600;\n    font-size: 1rem;\n    z-index: 5000;\n    opacity: 0;\n    transition: all 0.4s ease;\n    box-shadow: 0 8px 30px rgba(212,162,78,0.4);\n    text-align: center;\n    max-width: 90vw;\n  ",document.body.appendChild(n),n.textContent=e,requestAnimationFrame(()=>{n.style.opacity="1",n.style.transform="translateX(-50%) translateY(0)"}),setTimeout(()=>{n.style.opacity="0",n.style.transform="translateX(-50%) translateY(-20px)",setTimeout(()=>n.remove(),400)},t)}function launchConfetti(){const e=["#D4A24E","#EF4444","#10B981","#3B82F6","#F59E0B","#8B5CF6","#EC4899"];for(let t=0;t<80;t++){const t=document.createElement("div");t.className="confetti-piece",t.style.left=100*Math.random()+"vw",t.style.backgroundColor=e[Math.floor(Math.random()*e.length)],t.style.width=10*Math.random()+5+"px",t.style.height=10*Math.random()+5+"px",t.style.borderRadius=Math.random()>.5?"50%":"2px",t.style.animationDuration=2*Math.random()+2+"s",t.style.animationDelay=1*Math.random()+"s",document.body.appendChild(t),setTimeout(()=>t.remove(),4e3)}}function showResults(e,t,n,a){const s=saveGameScore(a,t,n),o=getXPBreakdown(t,n),c=3===s?"PERFECT! You are a UAE Culture Champion!":2===s?"Great job! Almost perfect!":"Good try! Keep learning and try again!",i=document.createElement("div");i.className="results-overlay",i.innerHTML=`\n    <div class="results-card">\n      <h2 style="color: #FFD700; font-size: 1.8rem; margin-bottom: 8px; font-family:'Orbitron',sans-serif;">${e}</h2>\n      <div class="results-score" id="resultsScoreNum">0/${n}</div>\n      <div class="results-stars" id="resultsStarsWrap"></div>\n      <div class="results-xp-breakdown">\n        <div class="xp-line"><span>Correct answers</span><span>+${o.perQuestion} XP</span></div>\n        <div class="xp-line"><span>Completion bonus</span><span>+${o.completionBonus} XP</span></div>\n        ${o.perfectBonus?`<div class="xp-line xp-perfect"><span>Perfect bonus!</span><span>+${o.perfectBonus} XP</span></div>`:""}\n        <div class="xp-line xp-total"><span>Total</span><span>+${o.total} XP</span></div>\n      </div>\n      <div class="results-message">${c}</div>\n      <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">\n        <button class="btn btn-gold" onclick="this.closest('.results-overlay').remove(); location.reload();">Play Again üîÑ</button>\n        <a href="/" class="btn btn-blue">Home üè†</a>\n      </div>\n    </div>\n  `,document.body.appendChild(i);const r=document.getElementById("resultsScoreNum");let l=0;if(t>0){const e=setInterval(()=>{l++,r.textContent=`${l}/${n}`,l>=t&&clearInterval(e)},80)}const u=document.getElementById("resultsStarsWrap");for(let e=0;e<3;e++){const t=document.createElement("span");t.textContent=e<s?"‚≠ê":"‚òÜ",t.style.cssText="display:inline-block;font-size:2rem;opacity:0;transform:scale(0);transition:all 0.4s cubic-bezier(0.175,0.885,0.32,1.275);",u.appendChild(t),setTimeout(()=>{t.style.opacity="1",t.style.transform="scale(1)"},400+300*e)}"undefined"!=typeof Mascot&&Mascot.onResults(s),s>=2&&(launchConfetti(),playSound("levelup"))}document.addEventListener("DOMContentLoaded",()=>{updateStarsDisplay();const e=document.getElementById("playerName");if(e){const t=getPlayerName();"Explorer"!==t&&(e.value=t)}initFactsCarousel(),updateCardStars(),initGameParticles(),"on"===localStorage.getItem("uaequest_music")&&document.addEventListener("click",function e(){startBackgroundMusic(),document.removeEventListener("click",e)},{once:!0}),updateSoundToggleBtn()});let currentUtterance=null;function speakText(e){if(!("speechSynthesis"in window))return;speechSynthesis.cancel();const t=new SpeechSynthesisUtterance(e);t.volume=1;const n=speechSynthesis.getVoices(),a="function"==typeof getSavedVoiceName?getSavedVoiceName():null,s="function"==typeof getSavedSpeed?getSavedSpeed():.9,o="function"==typeof getSavedPitch?getSavedPitch():1.05;if(t.rate=s,t.pitch=o,a){const e=n.find(e=>e.name===a);e&&(t.voice=e)}if(!t.voice){const e=n.find(e=>e.lang.startsWith("en")&&(e.name.includes("Google")||e.name.includes("Samantha")||e.name.includes("Microsoft")))||n.find(e=>e.lang.startsWith("en"));e&&(t.voice=e)}currentUtterance=t,speechSynthesis.speak(t)}function stopSpeaking(){"speechSynthesis"in window&&speechSynthesis.cancel()}function toggleVoiceBtn(e){if(e.classList.contains("playing"))stopSpeaking(),e.classList.remove("playing"),e.textContent="üîä Listen";else{const t=e.getAttribute("data-text");if(t&&speakText(t),e.classList.add("playing"),e.textContent="‚èπÔ∏è Stop","speechSynthesis"in window){const t=setInterval(()=>{speechSynthesis.speaking||(e.classList.remove("playing"),e.textContent="üîä Listen",clearInterval(t))},300)}}}function revealArabic(e){e.classList.toggle("revealed"),playSound("flip")}function playSound(e){if("off"!==localStorage.getItem("uaequest_sfx"))try{const t=new(window.AudioContext||window.webkitAudioContext),n=t.createGain();if(n.connect(t.destination),"correct"===e)[523.25,659.25,783.99].forEach((e,a)=>{const s=t.createOscillator(),o=t.createGain();s.frequency.value=e,o.gain.setValueAtTime(0,t.currentTime+.1*a),o.gain.linearRampToValueAtTime(.08,t.currentTime+.1*a+.05),o.gain.exponentialRampToValueAtTime(.001,t.currentTime+.1*a+.5),s.connect(o),o.connect(n),s.start(t.currentTime+.1*a),s.stop(t.currentTime+.1*a+.5)}),setTimeout(()=>t.close(),800);else if("wrong"===e){const e=t.createOscillator(),a=t.createOscillator(),s=t.createGain();e.frequency.value=200,a.frequency.value=212,e.type="sawtooth",a.type="sawtooth",s.gain.value=.04,s.gain.exponentialRampToValueAtTime(.001,t.currentTime+.4),e.connect(s),a.connect(s),s.connect(n),e.start(),a.start(),e.stop(t.currentTime+.4),a.stop(t.currentTime+.4),setTimeout(()=>t.close(),500)}else if("flip"===e){const e=t.createOscillator(),a=t.createGain();e.frequency.value=440,a.gain.value=.05,e.connect(a),a.connect(n),e.start(),e.stop(t.currentTime+.1),setTimeout(()=>t.close(),200)}else if("match"===e){const e=t.createOscillator(),a=t.createGain();e.frequency.value=587.33,a.gain.value=.1,e.connect(a),a.connect(n),e.start(),setTimeout(()=>{e.frequency.value=880},150),setTimeout(()=>{e.stop(),t.close()},300)}else"levelup"===e?([523.25,659.25,783.99,1046.5].forEach((e,a)=>{const s=t.createOscillator(),o=t.createGain();s.frequency.value=e,o.gain.setValueAtTime(0,t.currentTime+.12*a),o.gain.linearRampToValueAtTime(.1,t.currentTime+.12*a+.05),o.gain.exponentialRampToValueAtTime(.001,t.currentTime+.12*a+.6),s.connect(o),o.connect(n),s.start(t.currentTime+.12*a),s.stop(t.currentTime+.12*a+.6)}),setTimeout(()=>t.close(),1200)):"achievement"===e&&([1318.51,1567.98,2093].forEach((e,a)=>{const s=t.createOscillator(),o=t.createGain();s.frequency.value=e,o.gain.setValueAtTime(0,t.currentTime+.15*a),o.gain.linearRampToValueAtTime(.06,t.currentTime+.15*a+.03),o.gain.exponentialRampToValueAtTime(.001,t.currentTime+.15*a+.8),s.connect(o),o.connect(n),s.start(t.currentTime+.15*a),s.stop(t.currentTime+.15*a+.8)}),setTimeout(()=>t.close(),1500))}catch(e){}}"speechSynthesis"in window&&(speechSynthesis.onvoiceschanged=()=>speechSynthesis.getVoices(),speechSynthesis.getVoices());let musicCtx=null,musicPlaying=!1,musicGain=null,musicInterval=null;function startBackgroundMusic(){if(!musicPlaying)try{musicCtx||(musicCtx=new(window.AudioContext||window.webkitAudioContext),musicGain=musicCtx.createGain(),musicGain.gain.value=.03,musicGain.connect(musicCtx.destination)),musicPlaying=!0;const t=[293.66,349.23,392,440,466.16,587.33];let n=0;function e(){if(!musicPlaying)return;const e=musicCtx.createOscillator(),a=musicCtx.createGain();e.type="sine",e.frequency.value=t[n%t.length],a.gain.setValueAtTime(.03,musicCtx.currentTime),a.gain.exponentialRampToValueAtTime(.001,musicCtx.currentTime+2),e.connect(a),a.connect(musicGain),e.start(),e.stop(musicCtx.currentTime+2.5),n++}e(),musicInterval=setInterval(e,3e3),updateSoundToggleBtn()}catch(a){}}function stopBackgroundMusic(){musicPlaying=!1,musicInterval&&(clearInterval(musicInterval),musicInterval=null),updateSoundToggleBtn()}function toggleMusic(){musicPlaying?stopBackgroundMusic():startBackgroundMusic(),localStorage.setItem("uaequest_music",musicPlaying?"on":"off")}function updateSoundToggleBtn(){const e=document.getElementById("soundIcon"),t=document.getElementById("soundToggle");e&&t&&(e.textContent=musicPlaying?"üîä":"üîá",t.classList.toggle("music-on",musicPlaying))}function initGameParticles(){if("/"===window.location.pathname)return;const e=document.createElement("div");e.style.cssText="position:fixed;inset:0;pointer-events:none;z-index:0;overflow:hidden;";for(let t=0;t<4;t++){const n=document.createElement("span");n.className="hero-particle",n.style.left=15+22*t+"%",n.style.animationDelay=1.5*t+"s",e.appendChild(n)}document.body.appendChild(e)}