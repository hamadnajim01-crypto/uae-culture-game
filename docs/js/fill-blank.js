let fillData=[],fillCurrent=0,fillScore=0,fillAnswered=!1,fillStartHearts=0;async function startFillBlank(){try{const t=await fetch("/api/fill-blank");fillData=await t.json()}catch(t){return void showNotification("Failed to load questions!")}fillCurrent=0,fillScore=0,fillAnswered=!1,fillStartHearts=getHearts().current,document.getElementById("fillStart").style.display="none",document.getElementById("fillArea").style.display="block",updateStreak(),showFillQuestion()}function showFillQuestion(){if(fillCurrent>=fillData.length)return void finishFillBlank();fillAnswered=!1;const t=fillData[fillCurrent],e=fillData.length;document.getElementById("fillProgressFill").style.width=fillCurrent/e*100+"%",document.getElementById("fillProgressText").textContent=`${fillCurrent+1}/${e}`,document.getElementById("fillScore").textContent=`SCORE: ${fillScore}`;const l=document.getElementById("fillHearts");if(l){const t=getHearts();l.textContent="‚ù§Ô∏è".repeat(t.current)+"üñ§".repeat(5-t.current)}document.getElementById("fillSentence").innerHTML=t.sentence.replace("___",'<span class="fill-blank-slot" id="fillSlot">___</span>');const n=document.getElementById("fillHint");t.hint?(n.textContent="üí° Hint: "+t.hint,n.style.display="block"):n.style.display="none";const o=document.getElementById("fillWordBank");o.innerHTML="";[...t.options].sort(()=>Math.random()-.5).forEach(t=>{const e=document.createElement("button");e.className="fill-word-btn",e.textContent=t,e.onclick=()=>selectFillWord(t,e),o.appendChild(e)}),document.getElementById("fillFact").style.display="none",document.getElementById("fillNextBtn").style.display="none","undefined"!=typeof Mascot&&Mascot.onThink();const i=document.getElementById("fillCard");i.style.animation="none",i.offsetHeight,i.style.animation="fadeUp 0.4s ease"}function selectFillWord(t,e){if(fillAnswered)return;fillAnswered=!0;const l=fillData[fillCurrent],n=document.getElementById("fillSlot"),o=document.querySelectorAll(".fill-word-btn");if(n.textContent=t,o.forEach(t=>t.classList.add("disabled")),t===l.answer?(n.classList.add("correct"),e.classList.add("correct"),fillScore++,playSound("correct"),addXP(10),"undefined"!=typeof Mascot&&Mascot.onCorrect()):(n.classList.add("wrong"),e.classList.add("wrong"),o.forEach(t=>{t.textContent===l.answer&&t.classList.add("correct")}),playSound("wrong"),loseHeart(),"undefined"!=typeof Mascot&&Mascot.onWrong()),document.getElementById("fillScore").textContent=`SCORE: ${fillScore}`,l.fact){const t=document.getElementById("fillFact");t.textContent="üí° "+l.fact,t.style.display="block"}const i=document.getElementById("fillNextBtn");i.textContent=fillCurrent<fillData.length-1?"NEXT ‚Üí":"SEE RESULTS üèÜ",i.style.display="inline-flex";const a=document.getElementById("fillHearts");if(a){const t=getHearts();a.textContent="‚ù§Ô∏è".repeat(t.current)+"üñ§".repeat(5-t.current)}}function nextFillQuestion(){hasHearts()&&(fillCurrent++,showFillQuestion())}function finishFillBlank(){const t=fillData.length;addXP(50),fillScore===t&&addXP(25),markNodeComplete("fill-blank"),getHearts().current===fillStartHearts&&awardAchievement("no_hearts_lost"),fillScore===t&&awardAchievement("perfect_score"),showResults("Fill in the Blank Complete!",fillScore,t,"fill-blank")}