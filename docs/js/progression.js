const LEVELS=[{name:"Explorer",minXP:0,emoji:"üß≠"},{name:"Learner",minXP:100,emoji:"üìò"},{name:"Scholar",minXP:300,emoji:"üéì"},{name:"Expert",minXP:600,emoji:"üèÜ"},{name:"Champion",minXP:1e3,emoji:"üëë"},{name:"Legend",minXP:1500,emoji:"üåü"}],ACHIEVEMENTS=[{id:"first_lesson",name:"First Steps",emoji:"üë£",desc:"Complete your first lesson"},{id:"perfect_score",name:"Perfect Score",emoji:"üíØ",desc:"Get 100% on any quiz"},{id:"streak_7",name:"Week Warrior",emoji:"üî•",desc:"7-day streak"},{id:"streak_30",name:"Monthly Legend",emoji:"üìÖ",desc:"30-day streak"},{id:"all_sections",name:"UAE Expert",emoji:"üá¶üá™",desc:"Complete all learning sections"},{id:"xp_500",name:"XP Hunter",emoji:"‚ö°",desc:"Earn 500 XP"},{id:"xp_1000",name:"XP Master",emoji:"üíé",desc:"Earn 1000 XP"},{id:"all_games",name:"Game Master",emoji:"üéÆ",desc:"Play all mini-games"},{id:"speed_demon",name:"Speed Demon",emoji:"‚è±Ô∏è",desc:"Finish True/False under 60s"},{id:"no_hearts_lost",name:"Flawless",emoji:"‚ù§Ô∏è",desc:"Finish a quiz with all hearts"},{id:"happy_rashid",name:"Happy Rashid",emoji:"üòÑ",desc:"Make Rashid very happy!"}];function getXP(){return parseInt(localStorage.getItem("uaequest_xp")||"0")}function getCurrentLevel(){const e=getXP();let t=LEVELS[0];for(const n of LEVELS)e>=n.minXP&&(t=n);return t}function getNextLevel(){const e=getXP();for(const t of LEVELS)if(e<t.minXP)return t;return null}function getXPProgress(){const e=getXP(),t=getCurrentLevel(),n=getNextLevel();if(!n)return{xp:e,level:t,nextLevel:null,percent:100};const a=e-t.minXP,s=n.minXP-t.minXP;return{xp:e,level:t,nextLevel:n,percent:Math.floor(a/s*100)}}function addXP(e){const t=getCurrentLevel(),n=getXP()+e;localStorage.setItem("uaequest_xp",n.toString());const a=getCurrentLevel();return a.name!==t.name&&setTimeout(()=>showLevelUpCelebration(a),500),n>=500&&awardAchievement("xp_500"),n>=1e3&&awardAchievement("xp_1000"),updateNavDisplay(),n}function getStreak(){return JSON.parse(localStorage.getItem("uaequest_streak")||'{"count":0,"lastPlayedDate":null,"freezeAvailable":true}')}function updateStreak(){const e=getStreak(),t=(new Date).toISOString().split("T")[0];if(e.lastPlayedDate===t)return e;const n=new Date(Date.now()-864e5).toISOString().split("T")[0];if(e.lastPlayedDate===n)e.count++;else if(e.lastPlayedDate&&e.freezeAvailable){const t=new Date(Date.now()-1728e5).toISOString().split("T")[0];e.lastPlayedDate===t?(e.count++,e.freezeAvailable=!1):(e.count=1,e.freezeAvailable=!0)}else e.count=(e.lastPlayedDate,1),e.freezeAvailable=!0;return e.lastPlayedDate=t,localStorage.setItem("uaequest_streak",JSON.stringify(e)),e.count>=7&&awardAchievement("streak_7"),e.count>=30&&awardAchievement("streak_30"),updateNavDisplay(),e}function getHearts(){return JSON.parse(localStorage.getItem("uaequest_hearts")||'{"current":5,"max":5}')}function loseHeart(){const e=getHearts();return e.current=Math.max(0,e.current-1),localStorage.setItem("uaequest_hearts",JSON.stringify(e)),updateHeartsDisplay(),0===e.current&&showOutOfHeartsModal(),e.current}function resetHearts(){localStorage.setItem("uaequest_hearts",JSON.stringify({current:5,max:5})),updateHeartsDisplay()}function hasHearts(){return getHearts().current>0}function updateHeartsDisplay(){const e=getHearts(),t=document.getElementById("heartsDisplay");t&&(t.textContent="‚ù§Ô∏è".repeat(e.current)+"üñ§".repeat(5-e.current)),document.querySelectorAll(".quiz-hearts").forEach(t=>{t.textContent="‚ù§Ô∏è".repeat(e.current)+"üñ§".repeat(5-e.current)})}function showOutOfHeartsModal(){const e=document.createElement("div");e.className="results-overlay",e.id="heartsModal",e.innerHTML='\n    <div class="results-card">\n      <div style="font-size:3rem; margin-bottom:12px;">üíî</div>\n      <h2 style="font-family:\'Orbitron\',sans-serif; font-size:24px; margin-bottom:8px;">Out of Hearts!</h2>\n      <p class="results-message">Go back and study to earn more hearts!</p>\n      <div style="display:flex; gap:12px; justify-content:center; flex-wrap:wrap;">\n        <a href="/landmarks" class="btn btn-primary">Study More üìñ</a>\n        <a href="/" class="btn btn-outline">Home üè†</a>\n      </div>\n    </div>\n  ',document.body.appendChild(e)}function getEarnedAchievements(){return JSON.parse(localStorage.getItem("uaequest_achievements")||"[]")}function awardAchievement(e){const t=getEarnedAchievements();if(t.includes(e))return!1;t.push(e),localStorage.setItem("uaequest_achievements",JSON.stringify(t));const n=ACHIEVEMENTS.find(t=>t.id===e);return n&&showAchievementToast(n),!0}function showAchievementToast(e){const t=document.createElement("div");t.className="achievement-toast",t.innerHTML=`\n    <div class="achievement-toast-icon">${e.emoji}</div>\n    <div class="achievement-toast-text">\n      <strong>Badge Earned!</strong>\n      <span>${e.name}</span>\n    </div>\n  `,document.body.appendChild(t),requestAnimationFrame(()=>t.classList.add("show")),setTimeout(()=>{t.classList.remove("show"),setTimeout(()=>t.remove(),400)},3500),playSound("match")}function checkAchievements(){const e=getCompletedNodes(),t=getEarnedAchievements();e.length>=1&&!t.includes("first_lesson")&&awardAchievement("first_lesson");["landmarks","traditions","food"].every(t=>e.includes(t))&&!t.includes("all_sections")&&awardAchievement("all_sections");["quiz","matching","fill-blank","true-false","listening","scramble","timeline"].every(t=>e.includes(t))&&!t.includes("all_games")&&awardAchievement("all_games")}function getCompletedNodes(){return JSON.parse(localStorage.getItem("uaequest_completed")||"[]")}function markNodeComplete(e){const t=getCompletedNodes();t.includes(e)||(t.push(e),localStorage.setItem("uaequest_completed",JSON.stringify(t))),checkAchievements()}function isNodeComplete(e){return getCompletedNodes().includes(e)}function updateNavDisplay(){const e=getXPProgress(),t=document.getElementById("navXPFill"),n=document.getElementById("navXPText"),a=document.getElementById("navLevelBadge");t&&(t.style.width=e.percent+"%"),n&&(n.textContent=e.xp+" XP"),a&&(a.textContent=e.level.emoji+" "+e.level.name);const s=getStreak(),r=document.getElementById("streakCount");r&&(r.textContent=s.count),updateHeartsDisplay()}function showLevelUpCelebration(e){"function"==typeof launchConfetti&&launchConfetti(),"function"==typeof playSound&&playSound("correct");const t=document.createElement("div");t.className="results-overlay",t.innerHTML=`\n    <div class="results-card">\n      <div style="font-size:4rem; margin-bottom:8px;">${e.emoji}</div>\n      <h2 style="font-family:'Orbitron',sans-serif; font-size:28px; background:linear-gradient(135deg,#FFD700,#FF6B35); -webkit-background-clip:text; -webkit-text-fill-color:transparent; margin-bottom:8px;">LEVEL UP!</h2>\n      <p style="font-size:20px; font-weight:700; margin-bottom:4px;">${e.name}</p>\n      <p class="results-message">You reached ${e.minXP} XP!</p>\n      <button class="btn btn-primary btn-lg" onclick="this.closest('.results-overlay').remove()">AWESOME!</button>\n    </div>\n  `,document.body.appendChild(t)}document.addEventListener("DOMContentLoaded",()=>{updateStreak(),updateNavDisplay()});